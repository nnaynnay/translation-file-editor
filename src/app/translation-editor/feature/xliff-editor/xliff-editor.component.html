<div class="flex flex-col h-screen bg-background text-foreground overflow-hidden">
    <!-- Header -->
    @if (fileName()) {
    <header class="flex-none border-b px-6 py-4 flex justify-between items-center bg-background z-10">
        <div class="flex items-center gap-4">
            <img src="./assets/language.svg" alt="Language" class="w-6 h-6">
            <div class="flex flex-col gap-0">
                @if (fileName()) {
                <h1 class="text-lg font-bold tracking-tight text-foreground leading-none">{{ fileName() }}</h1>
                <div class="flex items-center gap-2 text-xs text-muted-foreground mt-1">
                    <span
                        class="uppercase font-mono bg-muted px-1.5 py-0.5 rounded text-[10px] tracking-wider font-medium">{{
                        documentFormat() }}</span>
                    <span>{{ sourceLang() || '?' }}</span>
                    <span class="text-[10px]">➜</span>
                    <span>{{ targetLang() || '?' }}</span>
                </div>
                }
            </div>
        </div>


        <div class="flex items-center gap-6">
            <!-- Stats -->
            <div class="flex items-center gap-6">
                <div class="flex gap-4 text-sm">
                    <div class="flex flex-col items-center">
                        <span
                            class="text-muted-foreground text-[10px] uppercase font-bold tracking-wider mb-0.5">Total</span>
                        <span class="font-bold text-foreground">{{ stats().total }}</span>
                    </div>
                    <div class="flex flex-col items-center">
                        <span
                            class="text-muted-foreground text-[10px] uppercase font-bold tracking-wider mb-0.5">Translated</span>
                        <span class="font-bold text-green-600 dark:text-green-400">{{ stats().translated }}</span>
                    </div>
                    <div class="flex flex-col items-center">
                        <span
                            class="text-muted-foreground text-[10px] uppercase font-bold tracking-wider mb-0.5">Missing</span>
                        <span class="font-bold text-orange-600 dark:text-orange-400">{{ stats().missing }}</span>
                    </div>
                    <div class="flex flex-col items-center">
                        <span
                            class="text-muted-foreground text-[10px] uppercase font-bold tracking-wider mb-0.5">Changed</span>
                        <span class="font-bold text-blue-600 dark:text-blue-400">{{ stats().changed }}</span>
                    </div>
                </div>

                <!-- Progress -->
                <div class="flex flex-col items-end min-w-[80px]">
                    <div class="flex items-baseline gap-1 mb-1">
                        <span class="text-xl font-bold tracking-tight">{{ (stats().translated / stats().total) * 100 |
                            number:'1.0-0' }}</span>
                        <span class="text-xs font-medium text-muted-foreground">%</span>
                    </div>
                    <div class="h-1.5 w-full bg-muted rounded-full overflow-hidden">
                        <div class="h-full bg-primary transition-all duration-500 ease-out"
                            [style.width.%]="(stats().translated / stats().total) * 100"></div>
                    </div>
                </div>
            </div>

            <!-- Separator -->
            <div class="h-8 w-px bg-border"></div>

            <!-- Buttons -->
            <div class="flex gap-2">
                <button (click)="exportFile('xliff')"
                    class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-9 px-4 py-2">
                    Export
                </button>
                <button (click)="reset()"
                    class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-destructive hover:text-destructive-foreground h-9 px-4 py-2">
                    Close
                </button>
            </div>
        </div>
    </header>
    }

    <!-- Main Content Area -->
    <div class="flex-1 flex overflow-hidden">
        @if (!fileName()) {

        <main class="flex-1 overflow-auto ">
            <div class="min-h-full flex flex-col items-center justify-center p-6 text-center max-w-4xl mx-auto py-20">
                <!-- Hero Section -->
                <div class="mb-12 space-y-4">
                    <h1 class="text-5xl md:text-6xl font-extrabold tracking-tight text-foreground">
                        Simple <span
                            class="bg-clip-text text-transparent bg-gradient-to-r from-primary to-blue-600">XLIFF
                            Editor</span>
                    </h1>
                    <p class="text-xl text-muted-foreground max-w-2xl mx-auto leading-relaxed">
                        Simple and easy to use XLIFF editor for translators.<br />
                        Support <span class="text-foreground font-semibold">XLIFF 1.2</span> and <span
                            class="text-foreground font-semibold">XLIFF 2.0</span>.
                    </p>
                </div>

                <!-- Main Action -->
                <div class="w-full mb-16">
                    <app-file-upload (fileSelected)="onFileSelected($event)" />
                </div>

            </div>
        </main>
        }
        @else {
        <!-- Left Pane: Table & Toolbar -->
        <div class="flex-1 flex flex-col min-w-0">


            <!-- Toolbar -->
            <div class="flex-none pt-4 px-4 flex items-center justify-between gap-4">
                <div class="flex items-center gap-2">
                    <!-- Search -->
                    <div class="relative w-72">
                        <div class="absolute inset-y-0 start-0 flex items-center ps-3 pointer-events-none">
                            <svg class="w-4 h-4 text-muted-foreground" aria-hidden="true"
                                xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20">
                                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                                    stroke-width="2" d="m19 19-4-4m0-7A7 7 0 1 1 1 8a7 7 0 0 1 14 0Z" />
                            </svg>
                        </div>
                        <input #searchInput type="text" [value]="filterQuery()" (input)="onSearchInput($event)"
                            (keydown.escape)="searchInput.blur()"
                            class="flex h-9 w-full rounded-md border border-input bg-background px-3 ps-10 py-1 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 pr-10"
                            placeholder="Search..." />
                        <kbd
                            class="pointer-events-none absolute right-1.5 top-1.5 hidden h-6 select-none items-center gap-1 rounded border bg-muted px-1.5 font-mono text-[10px] font-medium text-muted-foreground opacity-100 sm:flex">
                            <span class="text-sm">⌘</span>K
                        </kbd>
                    </div>

                    <!-- Filter Dropdown -->
                    <div class="flex items-center gap-2 relative">
                        <!-- Backdrop -->
                        @if (dropdownOpen()) {
                        <div class="fixed inset-0 z-30" (click)="closeDropdown()"></div>
                        }

                        <div class="relative z-40">
                            <button (click)="toggleDropdown()"
                                class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-9 px-3 gap-2"
                                title="Filter units">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3" />
                                </svg>
                                <span class="flex items-baseline gap-1">
                                    <span>
                                        @switch (filterStatus()) {
                                        @case ('all') { All }
                                        @case ('translated') { Translated }
                                        @case ('missing') { Missing }
                                        @case ('changed') { Changed }
                                        }
                                    </span>
                                    <span class="text-[10px] text-muted-foreground tabular-nums">
                                        @switch (filterStatus()) {
                                        @case ('all') { ({{ stats().total }}) }
                                        @case ('translated') { ({{ stats().translated }}) }
                                        @case ('missing') { ({{ stats().missing }}) }
                                        @case ('changed') { ({{ stats().changed }}) }
                                        }
                                    </span>
                                </span>
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round" class="h-3 w-3 opacity-50 ml-1">
                                    <path d="m6 9 6 6 6-6" />
                                </svg>
                            </button>

                            @if (dropdownOpen()) {
                            <div
                                class="absolute left-0 top-full mt-1 w-[200px] rounded-md border bg-popover text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95">
                                <div class="p-1">
                                    <button (click)="setFilter('all')"
                                        class="relative flex w-full cursor-default select-none items-center justify-between rounded-sm px-2 py-1.5 text-sm outline-none transition-colors hover:bg-accent hover:text-accent-foreground"
                                        [class.bg-accent]="filterStatus() === 'all'">
                                        <span>All</span>
                                        <span class="text-xs text-muted-foreground tabular-nums">{{ stats().total
                                            }}</span>
                                    </button>
                                    <button (click)="setFilter('translated')"
                                        class="relative flex w-full cursor-default select-none items-center justify-between rounded-sm px-2 py-1.5 text-sm outline-none transition-colors hover:bg-accent hover:text-accent-foreground"
                                        [class.bg-accent]="filterStatus() === 'translated'">
                                        <span>Translated</span>
                                        <span class="text-xs text-muted-foreground tabular-nums">{{
                                            stats().translated
                                            }}</span>
                                    </button>
                                    <button (click)="setFilter('missing')"
                                        class="relative flex w-full cursor-default select-none items-center justify-between rounded-sm px-2 py-1.5 text-sm outline-none transition-colors hover:bg-accent hover:text-accent-foreground"
                                        [class.bg-accent]="filterStatus() === 'missing'">
                                        <span>Missing</span>
                                        <span class="text-xs text-muted-foreground tabular-nums">{{ stats().missing
                                            }}</span>
                                    </button>
                                    <button (click)="setFilter('changed')"
                                        class="relative flex w-full cursor-default select-none items-center justify-between rounded-sm px-2 py-1.5 text-sm outline-none transition-colors hover:bg-accent hover:text-accent-foreground"
                                        [class.bg-accent]="filterStatus() === 'changed'">
                                        <span>Changed</span>
                                        <span class="text-xs text-muted-foreground tabular-nums">{{ stats().changed
                                            }}</span>
                                    </button>
                                </div>
                            </div>
                            }
                        </div>
                    </div>
                </div>

                <!-- Right Toolbar Actions -->
                <div class="flex items-center gap-2">

                    <!-- Unified View Dropdown -->
                    <div class="flex items-center gap-2 relative">
                        <!-- Backdrop -->
                        @if (viewSettingsOpen()) {
                        <div class="fixed inset-0 z-30" (click)="closeViewSettings()"></div>
                        }

                        <div class="relative z-40">
                            <button (click)="toggleViewSettings()"
                                class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-9 px-3 gap-2"
                                title="View Settings">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <path d="M3 3h18v18H3z" />
                                    <path d="M9 3v18" />
                                    <path d="M3 9h18" />
                                </svg>
                                <span>View</span>
                            </button>

                            @if (viewSettingsOpen()) {
                            <div
                                class="absolute right-0 top-full mt-1 w-[220px] rounded-md border bg-popover text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95">
                                <div class="p-2 space-y-3">
                                    <!-- View Density -->
                                    <div class="space-y-1.5">
                                        <div
                                            class="px-2 text-[10px] uppercase font-bold tracking-wider text-muted-foreground/70">
                                            Density
                                        </div>
                                        <div class="flex items-center rounded-md border bg-muted p-0.5 h-8">
                                            <button (click)="viewMode.set('compact')"
                                                [class.bg-background]="viewMode() === 'compact'"
                                                [class.shadow-sm]="viewMode() === 'compact'"
                                                [class.text-foreground]="viewMode() === 'compact'"
                                                [class.text-muted-foreground]="viewMode() !== 'compact'"
                                                class="flex-1 inline-flex items-center justify-center rounded-sm px-2 text-xs font-medium transition-all focus-visible:outline-none h-full">
                                                Compact
                                            </button>
                                            <button (click)="viewMode.set('spacious')"
                                                [class.bg-background]="viewMode() === 'spacious'"
                                                [class.shadow-sm]="viewMode() === 'spacious'"
                                                [class.text-foreground]="viewMode() === 'spacious'"
                                                [class.text-muted-foreground]="viewMode() !== 'spacious'"
                                                class="flex-1 inline-flex items-center justify-center rounded-sm px-2 text-xs font-medium transition-all focus-visible:outline-none h-full">
                                                Spacious
                                            </button>
                                        </div>
                                    </div>

                                    <!-- Separator Alternative -->
                                    <div class="h-px bg-border -mx-2"></div>

                                    <!-- Column Visibility -->
                                    <div class="space-y-0.5">
                                        <div
                                            class="px-2 pb-1 text-[10px] uppercase font-bold tracking-wider text-muted-foreground/70">
                                            Columns
                                        </div>
                                        <button (click)="showIdColumn.set(!showIdColumn())"
                                            class="relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors hover:bg-accent hover:text-accent-foreground">
                                            <span class="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
                                                @if (showIdColumn()) {
                                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                                    viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                                    stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"
                                                    class="h-3.5 w-3.5">
                                                    <polyline points="20 6 9 17 4 12" />
                                                </svg>
                                                }
                                            </span>
                                            <span>ID</span>
                                        </button>
                                        <button (click)="showSourceColumn.set(!showSourceColumn())"
                                            class="relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors hover:bg-accent hover:text-accent-foreground">
                                            <span class="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
                                                @if (showSourceColumn()) {
                                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                                    viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                                    stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"
                                                    class="h-3.5 w-3.5">
                                                    <polyline points="20 6 9 17 4 12" />
                                                </svg>
                                                }
                                            </span>
                                            <span>Source</span>
                                        </button>
                                        <button (click)="showTargetColumn.set(!showTargetColumn())"
                                            class="relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors hover:bg-accent hover:text-accent-foreground">
                                            <span class="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
                                                @if (showTargetColumn()) {
                                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                                    viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                                    stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"
                                                    class="h-3.5 w-3.5">
                                                    <polyline points="20 6 9 17 4 12" />
                                                </svg>
                                                }
                                            </span>
                                            <span>Target</span>
                                        </button>
                                        <button (click)="showNotesColumn.set(!showNotesColumn())"
                                            class="relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors hover:bg-accent hover:text-accent-foreground">
                                            <span class="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
                                                @if (showNotesColumn()) {
                                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                                    viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                                    stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"
                                                    class="h-3.5 w-3.5">
                                                    <polyline points="20 6 9 17 4 12" />
                                                </svg>
                                                }
                                            </span>
                                            <span>Notes</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            }
                        </div>
                    </div>
                </div>
            </div>

            <!-- Table Content (Scrollable) -->
            <div class="flex-1 overflow-auto p-4 pb-0">
                <div class="rounded-md border">
                    <app-translation-table [units]="paginatedUnits()" [viewMode]="viewMode()"
                        [showIdColumn]="showIdColumn()" [showSourceColumn]="showSourceColumn()"
                        [showTargetColumn]="showTargetColumn()" [showNotesColumn]="showNotesColumn()"
                        [selectedId]="selectedUnitId()" (unitSelect)="selectUnit($event)" />
                </div>
            </div>

            <!-- Pagination Footer (Sticky) -->
            <div class="flex-none p-4 bg-background border-t">
                <div class="flex items-center justify-between gap-4">
                    <div class="flex items-center gap-2">
                        <kbd
                            class="pointer-events-none h-5 select-none items-center gap-1 rounded border bg-muted px-1.5 font-mono text-lg font-medium text-muted-foreground flex">
                            ←
                        </kbd>
                        <kbd
                            class="pointer-events-none h-5 select-none items-center gap-1 rounded border bg-muted px-1.5 font-mono text-lg font-medium text-muted-foreground flex">
                            →
                        </kbd>
                        <span
                            class="text-[10px] text-muted-foreground font-medium uppercase tracking-wider">Navigate</span>
                    </div>

                    <app-pagination [pageIndex]="pageIndex()" [pageSize]="pageSize()" [total]="totalItems()"
                        (pageChange)="changePage($event)" />
                </div>
            </div>
        </div>

        <!-- Right Pane: Detail View -->
        @if (selectedUnit()) {
        <aside class="w-[400px] flex-none shadow-xl z-20">
            <app-translation-detail [unit]="selectedUnit()!" (save)="onUnitUpdate($event)"
                (close)="selectedUnitId.set(null)" />
        </aside>
        }
        }
    </div>
</div>